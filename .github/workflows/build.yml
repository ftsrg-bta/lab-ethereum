on: [push]

jobs:
  compile_paper_job:
    runs-on: ubuntu-latest
    name: Compile paper
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Install packages
      run: |
        sudo apt-get install -qq -y texlive-base texlive-science texlive-xetex texlive-fonts-recommended texlive-latex-extra
        sudo apt-get install lmodern
        wget https://github.com/jgm/pandoc/releases/download/2.11.3.2/pandoc-2.11.3.2-1-amd64.deb
        sudo dpkg -i pandoc-2.11.3.2-1-amd64.deb
    - name: Build guide.html
      run: pandoc guide.md --from=markdown_github-hard_line_breaks+yaml_metadata_block --output=guide.html --css=pandoc.css --standalone --self-contained --syntax-definition solidity.xml
    - name: Build vulnerabilities.html
      run: pandoc vulnerabilities.md --from=markdown_github-hard_line_breaks+yaml_metadata_block --output=vulnerabilities.html --css=pandoc.css --standalone --self-contained
    - name: Build guide.pdf
      run: pandoc guide.md --from=markdown_github-hard_line_breaks+yaml_metadata_block --output=guide.pdf -V geometry:margin=1in -V urlcolor:blue  --syntax-definition solidity.xml --highlight-style breezedark
    - name: Build vulnerabilities.pdf
      run: pandoc vulnerabilities.md --from=markdown_github-hard_line_breaks+yaml_metadata_block --output=vulnerabilities.pdf -V geometry:margin=1in -V urlcolor:blue
    - name: Collect results for deployment
      run: |
        mkdir out
        cp *.html out/
        cp *.pdf out/
        cp -R contracts/ out/contracts/
    - name: Deploy materials to gh-pages
      uses: JamesIves/github-pages-deploy-action@5dc1d5a192aeb5ab5b7d5a77b7d36aea4a7f5c92  # 4.1.4
      with:
        branch: gh-pages
        folder: out
        single-commit: true
      if: github.event_name == 'push' && github.ref == 'refs/heads/master'
